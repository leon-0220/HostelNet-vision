<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HostelNet | Student Rooms</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; margin:0; background:#f8f9fa; }

/* Layout & Sidebar */
.layout { display:flex; min-height:100vh; }
.sidebar {
  width: 220px;
  background: #fff3e0;
  color: #3e2723;
  padding: 20px;
  transition: transform 0.3s ease;
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  overflow-y: auto;
  z-index: 1000;
}
.sidebar.closed { 
  transform: translateX(-100%); 
}
.logo-box { 
  display:flex; 
  flex-direction:column; 
  align-items:center; 
  margin-bottom:20px; 
}
.logo-box img { 
  width:100%; 
  max-width:160px; 
  height:auto; 
  margin-bottom:5px; 
}
.sidebar h3 { 
  margin-bottom:20px; 
  text-align:center; 
}
.sidebar ul { 
  list-style:none; 
  padding:0; 
  margin:0; 
}
.sidebar ul li { 
  margin:15px 0; 
}
.sidebar ul li a { 
  color:#3e2723; 
  text-decoration:none; 
  display:block; 
  padding:10px; 
  border-radius:5px; 
  transition:0.3s; 
}
.sidebar ul li a:hover { 
  background:#ed5d2d; 
  color:#fff; 
}
.toggle-btn { 
  position:fixed; 
  top:15px; 
  left:15px; 
  background:#fff3e0; 
  border:none; 
  cursor:pointer; 
  padding:8px 12px; 
  border-radius:5px; 
  z-index:1100; 
  box-shadow:0 2px 4px rgba(0,0,0,0.2); 
}

/* Main Content */
.main-content { 
  flex:1; 
  margin-left:220px; 
  padding:20px; 
  background:linear-gradient(180deg,#ff4000,#eef3f8); 
  transition: margin-left 0.3s ease; 
  min-height: 100vh; 
}
.sidebar.closed ~ .main-content { 
  margin-left:0; 
}
.main-content h2 { 
  text-align:center; 
  margin-bottom:20px; 
  color:#000; 
}

/* Rooms Table */
table { 
  border-collapse: collapse; 
  width:100%; 
  margin-top:20px; 
  background:white; 
  border-radius:10px; 
  overflow:hidden; 
}
th, td { 
  border:1px solid #ccc; 
  padding:10px; 
  text-align:center; 
}
th { 
  background:#eee; 
}
.available { 
  color: green; 
  font-weight: bold; 
  cursor: pointer; 
  transition:0.3s; 
}
.available:hover { 
  color:#006400; 
  transform:scale(1.05); 
}
.occupied {
  color: red; 
  font-weight: bold; 
}

/* Modal Booking */
#bookingModal { 
  display:none; 
  position:fixed; 
  top:0; 
  left:0; 
  width:100%; 
  height:100%; 
  background: rgba(0,0,0,0.5); 
  z-index:999; 
}
.modal-inner { 
  display:flex; 
  justify-content:center; 
  align-items:center; 
  width:100%; 
  height:100%; 
}
#bookingModal .modal-content { 
  background:#fff; 
  padding:30px; 
  border-radius:15px; 
  max-width:500px; 
  width:90%; 
  position:relative; 
  box-shadow:0 4px 20px rgba(0,0,0,0.2); 
  animation:fadeIn 0.3s ease; 
}
#bookingModal .close-btn { 
  position:absolute; 
  top:15px; 
  right:15px; 
  font-size:1.8rem; 
  font-weight:bold; 
  color:#888; 
  background:none; 
  border:none; 
  cursor:pointer; 
}
#bookingModal .close-btn:hover { 
  color:#000; 
}
@keyframes fadeIn { 
  from {
    opacity:0; 
    transform:scale(0.8);
  } to {
    opacity:1; 
    transform:scale(1);
  } 
}
#bookingModal .form-label { 
  font-weight:500; 
}
#bookingModal .btn { 
  transition:all 0.3s ease; 
}
#bookingModal .btn:hover { 
  transform:translateY(-2px); 
  box-shadow:0 5px 15px rgba(0,0,0,0.2); 
  }
</style>
</head>
<body>

<div class="layout">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="logo-box">
      <img src="../../images/2.png" alt="Vision University College Logo">
      <h3>HostelNet</h3>
    </div>
    <ul>
      <li><a href="dashboard.html">üè† Home</a></li>
      <li><a href="profile.html">üë®‚Äçüéì My Profile</a></li>
      <li><a href="registration.html">üõè Online Registration</a></li>
      <li><a href="studentroom.html">üí≥ Room Selection</a></li>
      <li><a href="checkin.html">üìù Check-in</a></li>
      <li><a href="checkout.html">üìù Check-out</a></li>
      <li><a href="../../logout.html">üö™ Logout</a></li>
    </ul>
  </div>

  <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>

  <!-- Main Content -->
  <div class="main-content">
    <h2>Available Rooms</h2>
    <p>Click on an available room to book.</p>
    <div id="roomsContainer"></div>
  </div>
</div>

<!-- Modal -->
<div id="bookingModal">
<div class="modal-inner">
<div class="modal-content">
<button type="button" class="close-btn" id="closeModal">&times;</button>
<h4 class="card-title mb-3 text-center">üõè Book This Room</h4>
<form id="studentBookingForm">
<div class="mb-3">
<label class="form-label">Full Name</label>
<input type="text" class="form-control form-control-lg" name="name" readonly>
</div>
<div class="mb-3">
<label class="form-label">Student ID</label>
<input type="text" class="form-control form-control-lg" name="student_id" readonly>
</div>
<div class="mb-3">
<label class="form-label">Course</label>
<input type="text" class="form-control form-control-lg" name="course" readonly>
</div>
<div class="mb-3">
<label class="form-label">Hostel Unit</label>
<input type="text" class="form-control form-control-lg bg-light" name="hostel_unit" readonly>
</div>
<div class="mb-3">
<label class="form-label">Room Number</label>
<input type="text" class="form-control form-control-lg bg-light" name="room_number" readonly>
</div>
<div class="d-grid mt-3">
<button type="submit" class="btn btn-primary btn-lg">‚úÖ Confirm Booking</button>
</div>
</form>
</div>
</div>
</div>

<script>
// Room data
const rooms = [
{gender:"Male", hostel:"Kelana Parkview", room_id:"D401", status:"Occupied"},
{gender:"Male", hostel:"Kelana Parkview", room_id:"D402", status:"Available"},
{gender:"Male", hostel:"SS4D/8", room_id:"21A", status:"Available"},
{gender:"Male", hostel:"SS4D/8", room_id:"21B", status:"Available"},
{gender:"Female", hostel:"Kelana Parkview", room_id:"D201", status:"Available"},
{gender:"Female", hostel:"Kelana Parkview", room_id:"D202", status:"Occupied"},
{gender:"Female", hostel:"Focus Point", room_id:"20B2", status:"Available"},
{gender:"Female", hostel:"Spacepod", room_id:"36-3", status:"Occupied"},
];

const roomsContainer = document.getElementById('roomsContainer');
const bookingModal = document.getElementById('bookingModal');
const closeModalBtn = document.getElementById('closeModal');
const studentBookingForm = document.getElementById('studentBookingForm');
const hostelInput = studentBookingForm.querySelector('input[name="hostel_unit"]');
const roomInput = studentBookingForm.querySelector('input[name="room_number"]');

let selectedRoomIndex = null;
let currentUser = {};

// Fetch user data and auto-fill all fields
async function loadUserDetails() {
  try {
    const res = await fetch('https://hostelnet-vision-3.onrender.com/api/my-details', {credentials:'include'});
    if(!res.ok) throw new Error("Failed to fetch user data");
    currentUser = await res.json();
    studentBookingForm.querySelector('input[name="name"]').value = currentUser.name || '';
    studentBookingForm.querySelector('input[name="student_id"]').value = currentUser.student_id || '';
    studentBookingForm.querySelector('input[name="course"]').value = currentUser.course || '';
  } catch(err) { console.error(err); }
}

window.addEventListener('DOMContentLoaded', loadUserDetails);

function renderRooms() {
  let tableHTML = '<table class="table-hover"><tr><th>Gender</th><th>Hostel</th><th>Room No</th><th>Status</th></tr>';
  rooms.forEach((room,index)=>{
    if(room.status==="Available"){
      tableHTML+=`<tr>
      <td>${room.gender}</td>
      <td>${room.hostel}</td>
      <td>${room.room_id}</td>
      <td class="available" onclick="bookRoom(${index})">${room.status}</td>
      </tr>`;
    }
  });
  tableHTML+='</table>';
  roomsContainer.innerHTML = tableHTML;
}

function bookRoom(index){
  selectedRoomIndex = index;
  hostelInput.value = rooms[index].hostel;
  roomInput.value = rooms[index].room_id;
  bookingModal.style.display='flex';
}

// Close modal
closeModalBtn.addEventListener('click', ()=>{ bookingModal.style.display='none'; });
bookingModal.addEventListener('click',(e)=>{ if(e.target === bookingModal){ bookingModal.style.display='none'; }});

// Submit form
studentBookingForm.addEventListener('submit',(e)=>{
  e.preventDefault();
  if(selectedRoomIndex!==null){
    rooms[selectedRoomIndex].status="Occupied";
    alert("‚úÖ Booking successful for room "+rooms[selectedRoomIndex].room_id);
    bookingModal.style.display='none';
    renderRooms();
  }
});

function toggleSidebar(){ document.getElementById("sidebar").classList.toggle("closed"); }

renderRooms();
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HostelNet | Pending Complaints</title>
<link rel="icon" href="favicon.ico" type="image/x-icon"/>
<style>
body{
    font-family:Arial,sans-serif;
    background:#fff3e0;
    padding:20px;
}

h2{
    text-align:center;
    margin-bottom:30px;
    color:#ff8000;
}

table{
    background:#fff;
}

button{
    width:120px;
}
</style>
</head>
<body class="container">

<h2>ðŸ›  Pending Complaints</h2>
<div id="complaintsContainer"></div>

<script>
async function fetchComplaints() {
    const res = await fetch('complaints_api.php?action=get_pending');
    const data = await res.json();
    const container = document.getElementById('complaintsContainer');

    if(data.length === 0) {
        container.innerHTML = '<div class="alert alert-info">No pending complaints.</div>';
        return;
    }

    let html = '<table class="table table-bordered"><thead class="table-warning"><tr><th>ID</th><th>Student</th><th>Complaint</th><th>Action</th></tr></thead><tbody>';
    data.forEach(c => {
        html += `<tr>
            <td>${c.id}</td>
            <td>${c.student_id}</td>
            <td>${c.message}</td>
            <td><button class="btn btn-success btn-sm" onclick="markCompleted(${c.id})">Mark Completed</button></td>
        </tr>`;
    });
    html += '</tbody></table>';
    container.innerHTML = html;
}

async function markCompleted(id) {
    const res = await fetch('complaints_api.php?action=mark_completed', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({id})
    });
    const result = await res.json();
    if(result.status === 'success') {
        fetchComplaints(); // refresh table
    } else {
        alert('Error: ' + result.message);
    }
}
fetchComplaints();
</script>

</body>
</html>